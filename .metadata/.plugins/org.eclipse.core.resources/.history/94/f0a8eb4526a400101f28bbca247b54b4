@echo off
setlocal ENABLEEXTENSIONS

:: ===== 0 - Define folders =====
set "RES=target\allure-results"
set "REP=target\allure-report"

:: ===== 1 - Run Maven tests (TestNG) =====
call mvn -q test
if errorlevel 1 (
  echo Tests failed (Maven build failure). Still generating report for debugging...
)

:: ===== 2 - Copy history from previous report (for trends) =====
if exist "%REP%\history" (
  echo Copying history from previous report to new results...
  xcopy /E /I /Y "%REP%\history" "%RES%\history" >nul
)

:: ===== 3 - Generate new Allure report =====
allure generate "%RES%" -o "%REP%" --clean

:: ===== 4 - Open the generated report =====
allure open "%REP%"

echo.
echo âœ… Allure report generated successfully! Press any key to close.
pause >nul

endlocal
