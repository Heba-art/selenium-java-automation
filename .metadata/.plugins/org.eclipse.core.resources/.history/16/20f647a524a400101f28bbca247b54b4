@echo off
setlocal ENABLEEXTENSIONS

:: ===== 0 - مسارات المجلدات =====
set "RES=target\allure-results"
set "REP=target\allure-report"

:: ===== 1 - تشغيل الاختبارات بميفن (TestNG) =====
call mvn -q test
IF ERRORLEVEL 1 (
  echo Tests failed (Maven build failure). Still generating report for debugging...
)

:: ===== 2 - نسخ history من التقرير السابق (لإظهار Trends) =====
IF EXIST "%REP%\history" (
  echo Copying history from previous report to new results...
  xcopy /E /I /Y "%REP%\history" "%RES%\history" >nul
)

:: ===== 3 - توليد تقرير Allure =====
allure generate "%RES%" -o "%REP%" --clean

:: ===== 4 - فتح التقرير =====
allure open "%REP%"

endlocal
