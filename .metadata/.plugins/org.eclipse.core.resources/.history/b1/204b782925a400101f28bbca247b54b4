@echo off
setlocal ENABLEEXTENSIONS


set "RES=target\allure-results"
set "REP=target\allure-report"


call mvn -q test
IF ERRORLEVEL 1 (
  echo Tests failed (Maven build failure). Still generating report for debugging...
)


IF EXIST "%REP%\history" (
  echo Copying history from previous report to new results...
  xcopy /E /I /Y "%REP%\history" "%RES%\history" >nul
)

allure generate "%RES%" -o "%REP%" --clean

allure open "%REP%"

endlocal
